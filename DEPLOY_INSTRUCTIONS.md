# –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è –¥–µ–ø–ª–æ—é –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å

## –ö—Ä–æ–∫ 1: –õ–æ–∫–∞–ª—å–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É
cd /Users/user/my_pet_project/prosvitlo-backend
python -m py_compile app/scheduler.py
python -m py_compile app/models.py
python -m py_compile app/scraper/announcements_parser.py
python -m py_compile migrations/003_add_sent_announcement_hashes.py
```

## –ö—Ä–æ–∫ 2: Commit —Ç–∞ push –∑–º—ñ–Ω

```bash
# –î–æ–¥–∞—Ç–∏ –≤—Å—ñ –∑–º—ñ–Ω–µ–Ω—ñ —Ñ–∞–π–ª–∏
git add app/models.py
git add app/scheduler.py
git add app/scraper/announcements_parser.py
git add migrations/003_add_sent_announcement_hashes.py
git add run_migration_003.py
git add ANNOUNCEMENTS_FIX_SUMMARY.md
git add DEPLOY_INSTRUCTIONS.md

# –ó—Ä–æ–±–∏—Ç–∏ commit
git commit -m "Fix: –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç–∞–º –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å + –ø–æ–∫—Ä–∞—â–µ–Ω–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –æ–≥–æ–ª–æ—à–µ–Ω—å

- –î–æ–¥–∞–Ω–æ —Ç–∞–±–ª–∏—Ü—é sent_announcement_hashes –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ö–µ—à—ñ–≤ —É –ë–î
- –•–µ—à—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ —Å–µ—Ä–≤–µ—Ä–∞ (–∑–∞–ø–æ–±—ñ–≥–∞—î –¥—É–±–ª—ñ–∫–∞—Ç–∞–º)
- –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–∞—Ä—Å–∏–Ω–≥ _analyze_changes –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –≤—Å—ñ—Ö –æ–≥–æ–ª–æ—à–µ–Ω—å
- –ü–æ–∫—Ä–∞—â–µ–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –≤—ñ–¥–∫–ª—é—á–µ–Ω—å —É announcement_outages
- –î–æ–¥–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö —Ö–µ—à—ñ–≤ (>30 –¥–Ω—ñ–≤)
- –î–æ–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

Closes #XX (–Ω–æ–º–µ—Ä issue —è–∫—â–æ —î)"

# Push –Ω–∞ GitHub
git push origin main
```

## –ö—Ä–æ–∫ 3: –î–µ–ø–ª–æ–π –Ω–∞ Fly.io

Fly.io –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–¥–µ–ø–ª–æ—ó—Ç—å –ø—Ä–∏ push, –∞–ª–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –≤—Ä—É—á–Ω—É:

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
fly status

# –ó–∞–¥–µ–ø–ª–æ—ó—Ç–∏ –≤—Ä—É—á–Ω—É (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
fly deploy

# –ê–±–æ —á–µ—Ä–µ–∑ GitHub Actions —è–∫—â–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ
```

## –ö—Ä–æ–∫ 4: –ó–∞–ø—É—Å–∫ –º—ñ–≥—Ä–∞—Ü—ñ—ó –Ω–∞ production

**–í–ê–ñ–õ–ò–í–û:** –ú—ñ–≥—Ä–∞—Ü—ñ—é –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –ü–Ü–°–õ–Ø –¥–µ–ø–ª–æ—é –∫–æ–¥—É!

```bash
# –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ production —Å–µ—Ä–≤–µ—Ä–∞
fly ssh console -a prosvitlo-backend

# –£ –∫–æ–Ω—Å–æ–ª—ñ —Å–µ—Ä–≤–µ—Ä–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é
cd /app
python3 << 'EOF'
from migrations.003_add_sent_announcement_hashes import migrate
migrate('/data/prosvitlo.db')
print('‚úÖ –ú—ñ–≥—Ä–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞')
EOF

# –ê–±–æ –æ–¥–Ω–∏–º —Ä—è–¥–∫–æ–º:
python3 -c "from migrations.003_add_sent_announcement_hashes import migrate; migrate('/data/prosvitlo.db'); print('‚úÖ –ú—ñ–≥—Ä–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞')"

# –í–∏–π—Ç–∏ –∑ –∫–æ–Ω—Å–æ–ª—ñ
exit
```

## –ö—Ä–æ–∫ 5: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ –¥–æ–¥–∞—Ç–æ–∫ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ö–µ—à—ñ–≤ –∑ –ë–î
fly apps restart prosvitlo-backend

# –ê–±–æ —á–µ—Ä–µ–∑ scale (–∑—É–ø–∏–Ω–∏—Ç–∏ —Ç–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–∏)
fly scale count 0 -a prosvitlo-backend
fly scale count 1 -a prosvitlo-backend
```

## –ö—Ä–æ–∫ 6: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤

```bash
# –î–∏–≤–∏—Ç–∏—Å—è –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
fly logs -a prosvitlo-backend

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ —à—É–∫–∞—Ç–∏ –≤ –ª–æ–≥–∞—Ö:
# ‚úÖ "üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –∑ –ë–î: N —Ö–µ—à—ñ–≤ –æ–≥–æ–ª–æ—à–µ–Ω—å, M —Ö–µ—à—ñ–≤ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ñ–≤"
# ‚úÖ "üöÄ –ó–∞–ø—É—Å–∫ scheduler –∑ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–æ–º X —Ö–≤–∏–ª–∏–Ω"
# ‚úÖ "‚úÖ Job 'schedules' —Å—Ç–≤–æ—Ä–µ–Ω–æ"
# ‚úÖ "üìã –ó–Ω–∞–π–¥–µ–Ω–æ –ø–æ—á–∞—Ç–æ–∫ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –Ω–∞ –ø–æ–∑–∏—Ü—ñ—ó N"
# ‚úÖ "üíæ –ó–±–µ—Ä–µ–∂–µ–Ω–æ —Ö–µ—à –≤ –ë–î"

# –®—É–∫–∞—Ç–∏ –ø–æ–º–∏–ª–∫–∏
fly logs -a prosvitlo-backend | grep ERROR
fly logs -a prosvitlo-backend | grep "‚ùå"
```

## –ö—Ä–æ–∫ 7: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–µ—Ä–µ–∑ –ë–î:

```bash
fly ssh console -a prosvitlo-backend

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ —Ç–∞–±–ª–∏—Ü—è —Å—Ç–≤–æ—Ä–µ–Ω–∞
sqlite3 /data/prosvitlo.db "SELECT count(*) FROM sqlite_master WHERE type='table' AND name='sent_announcement_hashes';"

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–∞–ø–∏—Å–∏ (–ø—ñ—Å–ª—è —Ç–æ–≥–æ —è–∫ –±—É–¥—É—Ç—å –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è)
sqlite3 /data/prosvitlo.db "SELECT count(*), announcement_type FROM sent_announcement_hashes GROUP BY announcement_type;"

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
sqlite3 /data/prosvitlo.db "SELECT date, queue, start_hour, end_hour FROM announcement_outages WHERE is_active=1 ORDER BY date DESC LIMIT 10;"

exit
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–µ—Ä–µ–∑ API:

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å scheduler
curl https://prosvitlo-backend.fly.dev/health

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫–∏
curl https://prosvitlo-backend.fly.dev/api/v1/schedules/current | jq

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ—ó –∞–¥—Ä–µ—Å–∏
curl "https://prosvitlo-backend.fly.dev/api/v1/schedules/status?city=–•–∞—Ä–∫—ñ–≤—Ü—ñ&street=–≤—É–ª.%20–®–µ–≤—á–µ–Ω–∫–∞&house=3" | jq
```

## –ö—Ä–æ–∫ 8: –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ç—è–≥–æ–º –¥–Ω—è

–ü—ñ—Å–ª—è –¥–µ–ø–ª–æ—é –≤–∞–∂–ª–∏–≤–æ —Å—Ç–µ–∂–∏—Ç–∏ –∑–∞:

1. **–ù–æ–≤–∏–º–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è–º–∏** - —á–∏ –ø–∞—Ä—Å—è—Ç—å—Å—è –≤—Å—ñ (–Ω–µ —Ç—ñ–ª—å–∫–∏ –æ—Å—Ç–∞–Ω–Ω—î)
2. **–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º** - —á–∏ –Ω–µ–º–∞—î –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤
3. **–î–æ–¥–∞—Ç–∫–æ–≤–∏–º–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è–º–∏** - —á–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –ë–î
4. **Telegram –∫–∞–Ω–∞–ª–æ–º** - —á–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

```bash
# –î–∏–≤–∏—Ç–∏—Å—è –ª–æ–≥–∏ –∑ —Ñ—ñ–ª—å—Ç—Ä–æ–º –ø–æ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è—Ö
fly logs -a prosvitlo-backend | grep "üì¢"
fly logs -a prosvitlo-backend | grep "–æ–≥–æ–ª–æ—à–µ–Ω—å"

# –î–∏–≤–∏—Ç–∏—Å—è –ª–æ–≥–∏ –ø—Ä–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –ë–î
fly logs -a prosvitlo-backend | grep "üíæ"
```

## –í—ñ–¥–∫–∞—Ç (—è–∫—â–æ —â–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫)

```bash
# –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó –≤–µ—Ä—Å—ñ—ó
git revert HEAD
git push origin main

# –ê–±–æ —á–µ—Ä–µ–∑ Fly.io
fly releases list
fly releases rollback <version>
```

## –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

### –Ø–∫—â–æ –¥—É–±–ª—ñ–∫–∞—Ç–∏ –≤—Å–µ —â–µ —î:

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–ª–∏—Å—è —Ö–µ—à—ñ
fly logs | grep "–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –∑ –ë–î"

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –Ω–æ–≤—ñ —Ö–µ—à—ñ
fly logs | grep "–ó–±–µ—Ä–µ–∂–µ–Ω–æ —Ö–µ—à"

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–∞–ø–∏—Å–∏ –≤ –ë–î
fly ssh console
sqlite3 /data/prosvitlo.db
SELECT * FROM sent_announcement_hashes ORDER BY created_at DESC LIMIT 10;
.quit
exit
```

### –Ø–∫—â–æ –Ω–µ –≤—Å—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –ø–∞—Ä—Å—è—Ç—å—Å—è:

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏ –ø–∞—Ä—Å–µ—Ä–∞
fly logs | grep "–ó–Ω–∞–π–¥–µ–Ω–æ –ø–æ—á–∞—Ç–æ–∫ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è"
fly logs | grep "–°—Ç–≤–æ—Ä–µ–Ω–æ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è"

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤–º—ñ—Å—Ç –æ–≥–æ–ª–æ—à–µ–Ω—å
fly logs | grep "üìç"
```

## –ö–æ–Ω—Ç–∞–∫—Ç–∏ –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏

–Ø–∫—â–æ –≤–∏–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º–∏:
1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏: `fly logs -a prosvitlo-backend`
2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å: `fly status -a prosvitlo-backend`
3. –°—Ç–≤–æ—Ä–∏—Ç–∏ issue –Ω–∞ GitHub –∑ –æ–ø–∏—Å–æ–º –ø—Ä–æ–±–ª–µ–º–∏ —Ç–∞ –ª–æ–≥–∞–º–∏
